{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="description" content="Concentric circles"/>
    <title>Concentric circles</title>
    <link type="text/css" href="{% static 'styles/storymap.css' %}" rel="stylesheet"/>
    <script src="http://d3js.org/d3.v3.min.js"></script>
  </head>
  <body>
    <div class="fullSvg">
      <svg width="1000" height="810">
      </svg>
    </div>
    <div class="singleNode">
    </div>
  </body>
  <script>
    function test(text){
     alert(text)
    }

    function get_coordinates_from_angle(originx, originy, angle, radius) {
      newx = radius * Math.cos(angle * Math.PI/180) + originx
      newy = radius * Math.sin(angle * Math.PI/180) + originy 

      return [newx, newy];
    }

    function average_angles(list_of_angles) {
      combined_angles = []
      for (i=0;i<list_of_angles.length; i+=2) {
        new_angle = (list_of_angles[i] + list_of_angles[i+1])/2
        combined_angles.push(new_angle)
      }
      return combined_angles
      
    }

    function draw_arcs_lines(target_obj, angles, circle_num) {
        nodes = []
        for (var i = 0; i < angles.length; i++) {
          nodeCoords = get_coordinates_from_angle(initial_center_x, initial_center_y, angles[i], radii[circle_num-1])
          nodes.push(nodeCoords)
        }
        for (i=0; i< nodes.length; i+=2) {
          kid1 = nodes[i]
          kid2 = nodes[i+1]
          target2.append('path')
          .attr('d', 'M' + kid1[0] + ' ' + kid1[1] + "\nA " + radii[circle_num-1] + ' ' + radii[circle_num-1] + ' 90 0 1' + kid2[0] + ' ' + kid2[1])
          .attr('stroke', 'black')
          .attr('fill', 'none')
        }
        line_angles = average_angles(angles)
        for (angle of line_angles) {
          coords = get_coordinates_from_angle(initial_center_x, initial_center_y, angle, radii[circle_num-1])
          if (circle_num == 2) {
            linestart_coords = [initial_center_x, initial_center_y]
          } else {
          linestart_coords = get_coordinates_from_angle(initial_center_x, initial_center_y, angle, radii[circle_num-2]  + node_radius)
          }
          target_obj.append('line')
            .attr('x1', linestart_coords[0])
            .attr('x2', coords[0])
            .attr('y1', linestart_coords[1])
            .attr('y2', coords[1])
            .attr('stroke', 'black')
        }
        return nodes
    }

    function draw_nodes(target_obj, nodes) { 
      for (i=0; i< nodes.length; i++) {
        target_obj.append('circle')
              .attr('class', 'storycircle')
              .attr('r', node_radius)
              .attr('transform', "translate(" + nodes[i][0] + "," + nodes[i][1] + ")");
      }
    }

    function onNodeClick(prev_color, cur_color, child_color) {

    }

    var bbox, radii, svg, target;

    svg = d3.select('svg');
    bbox = svg[0][0].getBoundingClientRect();

    radii = [25, 80, 160, 240, 310, 385]

    node_radius = 25 

    initial_center_x = bbox.width/2
    initial_center_y = bbox.height/2


    target = svg.append('g')
        .attr('transform', "translate(" + initial_center_x + "," + initial_center_y + ")");

    /*target.selectAll('circle')
        .data(radii)
      .enter().append('circle')
        .attr('class', 'circle')
        .attr('r', function(d) {return d;});*/

    var freesound = new Audio('https://freesound.org/data/previews/223/223083_3966588-lq.mp3')
    target1 = svg.append('g').attr('fill', 'darkblue')
    target1.append('circle')
        .attr('class', 'storycircle')
        .attr('r', node_radius)
        .attr('onclick', 'freesound.play()')
        .attr('transform', "translate(" + initial_center_x + "," + initial_center_y + ")");


    target2 = svg.append('g').attr('fill', 'red');
    angles2 = [90, 270]
    nodes2 = draw_arcs_lines(target2, angles2, 2)

    target3 = svg.append('g').attr('fill', 'green')
    angles3 = [50, 130, 230, 310]
    nodes3 = draw_arcs_lines(target3, angles3, 3)

    target4 = svg.append('g').attr('fill', 'blue')
    angles4 = [30, 70, 110, 150, 210, 250, 290, 330]
    nodes4 = draw_arcs_lines(target4, angles4, 4)

    target5 = svg.append('g').attr('fill', 'hotpink')
    angles5 = [18, 42, 58, 82, 98, 122, 138, 162, 198, 222, 238, 262, 278, 302, 318, 342]
    nodes5 = draw_arcs_lines(target5, angles5, 5)

    target6 = svg.append('g').attr('fill', 'navy')
    angles6 = [14, 22, 38, 46, 54, 62, 78, 86, 94, 102, 118, 126, 134, 142, 158, 166, 194, 202, 218, 226, 234, 242, 258, 266, 274, 282, 298, 306, 314, 322, 338, 346]
    nodes6 = draw_arcs_lines(target6, angles6, 6)

    draw_nodes(target2, nodes2)
    draw_nodes(target3, nodes3)
    draw_nodes(target4, nodes4)
    draw_nodes(target5, nodes5)
    draw_nodes(target6, nodes6)

  </script>
</html>